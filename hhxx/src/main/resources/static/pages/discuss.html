<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>留言</title>
    <link rel="stylesheet" type="text/css" href="../login/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="../login/css/demo.css" />
    <!--必要样式-->
    <link rel="stylesheet" type="text/css" href="../login/css/component.css" />
    <link rel="stylesheet" type="text/css" href="../layui/css/layui.css" />
    <script type="text/javascript" src="../jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../layui/layui.js"></script>
    <style>
        .wyp-label {
            float: left;
            display: block;
            padding: 9px 15px;
            font-weight: 400;
            line-height: 20px;
            text-align: right;
        }
        .bar6 input {
            height: 42px;
            width: 300px;
            /*#c5464a*/
            border: 2px solid #fffef93b;
            border-radius: 5px;
            background: transparent;
            color: #C0C0C0;
            top: 0;
            right: 0;
        }
        .bar6 input::-webkit-input-placeholder {
            color: #C0C0C0;
            font-size: 16px;
        }


        .bar6 button {
            background: #46c5a929;
            border-radius: 12px 12px 12px 12px;
            width: 65px;
            height: 40px;
            top: 0;
            right: 0;
        }
        .bar6 button:before {
            content: "搜索";
            font-size: 16px;
            color: #F9F0DA;
        }
        .layui-nav *{font-size:15px}
        .layui-card{margin-bottom:15px;border-radius:2px;background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.05)}
        .layui-card-wyp-header {
            position: relative;
            height: 32px;
            line-height: 32px;
            padding: 0 10px;
            border-bottom: 1px solid #f6f6f6;
            color: #333;
            border-radius: 2px 2px 0 0;
            font-size: 14px;
        }
        .layui-card-wyp2-header {
            position: relative;
            height: 50px;
            line-height: 50px;
            padding: 0 10px;
            border-bottom: 1px solid #f6f6f6;
            color: #333;
            border-radius: 2px 2px 0 0;
            font-size: 14px;
        }
        .layui-card-wyp1-body {
            position: relative;
            padding: 3px 20px;
            line-height: 25px;
        }
        .layui-card-wyp2-body {
            position: relative;
            padding: 0px 10px;
            margin-left: 650px;
            line-height: 25px;
        }
    </style>

</head>


<body>
<ul class="layui-nav" style="background-color: #464646">
    <li class="layui-nav-item"><a href="blogindex.html" ><img style="width: 200px" src="../img/yujiblog.png"></a></li>
    <li class="layui-nav-item "><a href="blogCommon.html">技术分享</a></li>
    <li class="layui-nav-item"><a href="life.html">生活乐趣</a></li>
    <li class="layui-nav-item">
        <a href="javascript:;">心情随笔</a>
        <!--<dl class="layui-nav-child">-->
            <!--<dd><a href="">移动模块</a></dd>-->
            <!--<dd><a href="">后台模版</a></dd>-->
            <!--<dd><a href="">电商平台</a></dd>-->
        <!--</dl>-->
    </li>
    <li class="layui-nav-item layui-this"><a href="discuss.html">留言</a></li>
    <li class="layui-nav-item"><a href="aboutMe.html">关于我</a></li>
    <li class="layui-nav-item bar6" style="padding: 2px 0px;" ><input type="text"  placeholder="请输入您要搜索的内容..." ><button type="submit" ></button></li>
    <li class="layui-nav-item" style="float:right;" >
        <a href="login.html" id="nameOne"></a>
    </li>
    <li class="layui-nav-item" style="float:right;" >
        <a href="javascript:;"><img class="layui-nav-img" src="../img/头像.png"></a>
        <dl class="layui-nav-child">
            <dd><a id="PeCe">个人中心</a></dd>
            <dd><a href="javascript:;">博客管理</a></dd>
            <dd><a href="javascript:;">我的收藏</a></dd>
            <dd><a href="javascript:;">我的关注</a></dd>
            <dd><a href="login.html">注销</a></dd>
        </dl>
    </li>
    <li class="layui-nav-item" style="float:right;"><a id="writeBlog">写博客</a></li>
</ul>
<div class="layui-row" style="background-image: url(../img/留言背景.jpg);background-size:100%">
    <div class="layui-col-xs12 layui-col-md1">
         <br>
    </div>
    <div class="layui-col-xs12 layui-col-md8">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend style="font-size:40px" id="leaveMessSum">留言区</legend>
        </fieldset>
        <div class="layui-card">
            <div class="layui-card-wyp-header" style="font-size:20px;background-color: blanchedalmond" id="userName1">用户A</div>
            <div class="layui-card-wyp1-body" id="mess1" style="font-size:17px;color: darkviolet">

            </div>
            <div class="layui-card-wyp2-body" style="font-size:13px;"><a href="" id="time1">留言时间:2019.11.5</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button class="layui-btn layui-btn-warm layui-btn-radius" style=" height: 18px;line-height: 18px;padding: 0 12px;" type="button">回复</button></div>
        </div>
        <div class="layui-card" >
            <div class="layui-card-wyp-header" style="font-size:20px;background-color: blanchedalmond" id="userName2">用户A</div>
            <div class="layui-card-wyp1-body" id="mess2" style="font-size:17px;color: darkviolet">

            </div>
            <div class="layui-card-wyp2-body" style="font-size:13px;"><a href="" id="time2">留言时间:2019.11.5</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button class="layui-btn layui-btn-warm layui-btn-radius" style=" height: 18px;line-height: 18px;padding: 0 12px;" type="button">回复</button></div>
        </div>
        <div class="layui-card">
            <div class="layui-card-wyp-header" style="font-size:20px;background-color: blanchedalmond" id="userName3">用户A</div>
            <div class="layui-card-wyp1-body" id="mess3" style="font-size:17px;color: darkviolet">

            </div>
            <div class="layui-card-wyp2-body" style="font-size:13px;"><a href="" id="time3">留言时间:2019.11.5</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button class="layui-btn layui-btn-warm layui-btn-radius" style=" height: 18px;line-height: 18px;padding: 0 12px;" type="button">回复</button></div>
        </div>
        <div class="layui-card">
            <div class="layui-card-wyp-header" style="font-size:20px;background-color: blanchedalmond"  id="userName4">用户A</div>
            <div class="layui-card-wyp1-body" id="mess4" style="font-size:17px;color: darkviolet">

            </div>
            <div class="layui-card-wyp2-body" style="font-size:13px;"><a href="" id="time4">留言时间:2019.11.5</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button class="layui-btn layui-btn-warm layui-btn-radius" style=" height: 18px;line-height: 18px;padding: 0 12px;" type="button">回复</button></div>
        </div>
        <div class="layui-card">
            <div class="layui-card-wyp-header" style="font-size:20px;background-color: blanchedalmond"  id="userName5">用户A</div>
            <div class="layui-card-wyp1-body" id="mess5" style="font-size:17px;color: darkviolet">

            </div>
            <div class="layui-card-wyp2-body" style="font-size:13px;"><a href="" id="time5">留言时间:2019.11.5</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button class="layui-btn layui-btn-warm layui-btn-radius" style=" height: 18px;line-height: 18px;padding: 0 12px;" type="button">回复</button></div>
        </div>
        <div class="layui-card">
            <div class="layui-card-wyp-header" style="font-size:20px;background-color: blanchedalmond"  id="userName6">用户A</div>
            <div class="layui-card-wyp1-body" id="mess6" style="font-size:17px;color: darkviolet">

            </div>
            <div class="layui-card-wyp2-body" style="font-size:13px;"><a href="" id="time6">留言时间:2019.11.5</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button class="layui-btn layui-btn-warm layui-btn-radius" style=" height: 18px;line-height: 18px;padding: 0 12px;" type="button">回复</button></div>
        </div>
        <div class="layui-card">
            <div class="layui-card-wyp2-header" style="font-size:20px;background-color: blanchedalmond">
                <button class="layui-btn layui-btn-radius" type="button" style="margin-left: 200px;" id="upPage">上一页</button>
                <button class="layui-btn layui-btn-radius" type="button" style="margin-left: 150px;" id="leaveMess">我也要留言</button>
                <button class="layui-btn layui-btn-radius" type="button" style="margin-left: 150px;" id="downPage">下一页</button>
            </div>
        </div>
        <br>
        <br>
        <br>
    </div>
    <div  class="layui-col-xs12 layui-col-md3">

    </div>
</div>
</body>
<script type="text/javascript">
    layui.use(['element','layer' ], function(){
        var ab = layui.jquery
            ,element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块
        var layer = layui.layer;
        var numberOne = 0;
        var numberSum = 0;
        window.onload = function(){
            func1();
            func2();
        };
        function func1() {
            $.ajax({
                url: "getUserInfo",
                type: "GET",
                contentType: "application/json",
                async: true,
                success: function (data) {
                    console.log(data);
                    if (data.flag == true) {
                        $("#nameOne").text(data.data["userName"]);
                        $("#nameOne").removeAttr("href");
                    }else if(data.flag == false){
                        $("#nameOne").text(data.data);
                    }
                }
            });
        }
        function func2(){
            $.ajax({
                url: "getMess",
                type: "GET",
                contentType: "application/json",
                async: true,
                success: function (data) {
                    console.log(data);
                    if (data.flag == true) {
                        console.log(data);
                        nu = 1;
                        numberSum = data.data["mess"].length;
                        $("#leaveMessSum").text("留言区("+data.data["mess"].length+"条)");
                        for(var w=data.data["mess"].length-1-numberOne;w>=data.data["mess"].length-6-numberOne;w--)
                        {
                            $("#userName"+nu).text("用户："+data.data["mess"][w]["userName"]);
                            $("#mess"+nu).text(data.data["mess"][w]["content"]);
                            $("#time"+nu).text("留言时间："+data.data["mess"][w]["createDate"]);
                            if (w==0){
                                console.log(nu);
                                for (var i=nu+1;i<=6;i++) {
                                    $("#userName"+i).text("");
                                    $("#mess"+i).text("");
                                    $("#time"+i).text("");
                                }
                                break;
                            }
                            nu++;

                        }
                    }
                }
            })
        }
        $("#leaveMess").on("click",function(){
            leaveMess();
        });
        function leaveMess() {
            layer.open({
                title: '留言板'
                ,content: '<textarea id="text" name="" required lay-verify="required" placeholder="你有什么想说的吗" class="layui-textarea"></textarea>'
                ,btn: ['留言']
                ,area: ['450px', '230px']
                ,btn1: function () {
                    var content = $("#text").val();
                    if (content == null || content == '') {
                        layer.open({
                            title: '提示'
                            , icon:2
                            , content: '温馨提示:留言内容不能为空！'
                        });
                    }else{
                        $.ajax({
                            url: "insertMess",
                            type: "Post",
                            contentType: "application/json",
                            data: "{\"content\":\""+ content +"\"}",
                            async: true,
                            success: function (body) {
                                console.log(body);
                                if (body.flag == true) {
                                    layer.open({
                                        title: '提示'
                                        , icon:1
                                        , content: '温馨提示:留言成功！'
                                        , btn:['确定']
                                        , btn1:function () {
                                            window.location = 'discuss.html'
                                        }
                                    });
                                }else if(body.flag == false){
                                    layer.open({
                                        title: '提示'
                                        , icon:2
                                        , content: '温馨提示:请先登陆！'
                                    });
                                }
                            }
                        });
                    }
                }
            });
        }
        //上一页
        $("#upPage").on("click",function(){
            upPage();
        });
        function upPage(){
            numberOne = numberOne-6;
            if (numberOne<=-6){
                numberOne = 0;
                layer.open({
                    title: '提示'
                    , icon:0
                    , content: '不能再上一页啦，已经到头了'
                });
            }else{
                func2();
            }
        }
        //下一页
        $("#downPage").on("click",function () {
            downPage();
        });
        function downPage(){
            numberOne = numberOne +6;
            if (numberOne >=numberSum){
                numberOne = numberOne -6;
                layer.open({
                    title: '提示'
                    , icon:0
                    , content: '不能再下一页啦，已经到头了'
                })
            }else {
                func2()
            }
        }
        //判断是否登陆，提示用户
        $("#PeCe").on("click",function(){
            PeCe();
        });

        function PeCe() {
            $.ajax({
                url: "getUserInfo",
                type: "GET",
                contentType: "application/json",
                async: true,
                success: function (body) {
                    console.log(body);
                    if (body.flag == true) {
                        window.location.href = "userInfo.html";
                    }else if(body.flag == false){
                        layer.open({
                            title: '提示'
                            , icon:2
                            , content: '温馨提示:请登陆！'
                        });
                    }
                }
            });
        }
        $("#writeBlog").on("click",function(){
            writeBlog();
        });
        function writeBlog() {
            $.ajax({
                url: "getUserInfo",
                type: "GET",
                contentType: "application/json",
                async: true,
                success: function (body) {
                    console.log(body);
                    if (body.flag == true) {
                        window.location.href = "uploadBlog.html";
                    }else if(body.flag == false){
                        layer.open({
                            title: '提示'
                            , icon:2
                            , content: '温馨提示:请登陆！'
                        });
                    }
                }
            });
        }
        //触发事件
        var active = {
            tabAdd: function(){
                //新增一个Tab项
                element.tabAdd('demo', {
                    title: '新选项'+ (Math.random()*1000|0) //用于演示
                    ,content: '内容'+ (Math.random()*1000|0)
                    ,id: new Date().getTime() //实际使用一般是规定好的id，这里以时间戳模拟下
                })
            }
            ,tabDelete: function(othis){
                //删除指定Tab项
                element.tabDelete('demo', '44'); //删除：“商品管理”
                othis.addClass('layui-btn-disabled');
            }
            ,tabChange: function(){
                //切换到指定Tab项
                element.tabChange('demo', '22'); //切换到：用户管理
            }
        };

        ab('.site-demo-active').on('click', function(){
            var othis = ab(this), type = othis.data('type');
            active[type] ? active[type].call(this, othis) : '';
        });

        //Hash地址的定位
        var layid = location.hash.replace(/^#test=/, '');
        element.tabChange('test', layid);

        element.on('tab(test)', function(elem){
            location.hash = 'test='+ ab(this).attr('lay-id');
        });
    });


</script>

</html>
